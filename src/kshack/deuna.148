TITLE DEUNA - poke at a DEUNA

.insrt system; ksdefs >

a=1
b=2
c=3
d=4
e=5
t=11
p=17

.insrt system; dedefs >

define pcsr0 x
	movei t,x
	iowri t,%decr0
termin

go:
	move p,[-100,,pdl]

	seto a,			;Enable user I/O
	.iotlsr a,

	pcsr0 %drset		;Reset DEUNA
	pushj p,wait

	pcsr0 %dinte		;Enable interrupt

	setz a,			;Clear PCSR2 and 3
	iowri a,%decr2
	iowri a,%decr3

	pcsr0 %dinte+%dgpcb	;Command Get PCB block
				;Expect an interrupt

	.call [setz	
		sixbit /CORBLK/
		movei %cbndr+%cblok	;Get a locked page.
		movei %jself ? movei page
		movei %jsnew]

	;	movei %cbndr		;Get an absolute page.
	;	movei %jself ? movei page
	;	movei %jsabs ? setzi 100]
	 .lose

	.break 16,1,,0
done:	jfcl
	.call [setz
		sixbit /CORTYP/
		movei page
		movem a ? movem b ? movem c ? movem d ? setzm e]
	 .lose

	.logout 1,

wait:	iordi a,%decr0		;Wait for interrupt bit
	trnn a,%dintr
	 jrst wait
	popj p,

pdl:	block 100

page==<.+1777>_-12

end go
